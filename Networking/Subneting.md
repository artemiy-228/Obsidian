## Subnetting

Разделение диапазона IPv4-адресов на несколько более мелких поддиапазонов называется разделением на подсети.

### **Подсеть (Subnet) и сетевой адрес:**
Подсеть - это логический сегмент сети, который использует IP-адреса с одинаковым сетевым адресом. Можно представить подсеть как помеченный вход в большом коридоре здания. Например, это может быть стеклянная дверь, разделяющая различные отделы здания компании. С помощью разделения на подсети можно создавать конкретные подсети или узнавать следующую информацию о соответствующей сети:

- Сетевой адрес
- Broadcast-адрес
- Первый хост
- Последний хост
- Количество хостов

Пример:
IPv4-адрес: 192.168.12.160
Маска подсети: 255.255.255.192
CIDR: 192.168.12.160/26

IPv4-адрес делится на сетевую часть и хостовую часть.

### **Сетевая часть:**
IPv4: 1100 0000 1010 1000 0000 1100 1010 0000 (192.168.12.160/26)
Маска подсети: 1111 1111 1111 1111 1111 1111 1100 0000 (255.255.255.192)
Биты: /8 /16 /24 /32

В разделении на подсети мы используем маску подсети в качестве шаблона для IPv4-адреса. Из единиц в маске подсети мы знаем, какие биты в IPv4-адресе не могут быть изменены. Они являются фиксированными и определяют "основную сеть", в которой находится подсеть.

### **Хостовая часть:**
IPv4: 1100 0000 1010 1000 0000 1100 1010 0000 (192.168.12.160/26)
Маска подсети: 1111 1111 1111 1111 1111 1111 1100 0000 (255.255.255.192)
Биты: /8 /16 /24 /32

Биты в хостовой части могут быть изменены на первый и последний адрес. Первый адрес - это сетевой адрес, а последний адрес - это broadcast-адрес для соответствующей подсети.

Сетевой адрес необходим для доставки пакета данных. Если сетевой адрес совпадает сетевым адресом исходного и целевого адреса, пакет данных доставляется в пределах одной подсети. Если сетевые адреса отличаются, пакет данных должен быть маршрутизирован в другую подсеть через шлюз по умолчанию.

Маска подсети определяет, где происходит это разделение.

### **Разделение на сетевую и хостовую части:**
IPv4: 1100 0000 1010 1000 0000 1100 10|10 0000 (192.168.12.160/26)
Маска подсети: 1111 1111 1111 1111 1111 1111 11|00 0000 (255.255.255.192)
Биты: /8 /16 /24 /32

### **Сетевой адрес:**
Если установить все биты хостовой части IPv4-адреса в 0, мы получим сетевой адрес соответствующей подсети.

IPv4: 1100 0000 1010 1000 0000 1100 10|00 0000 (192.168.12.128/26)
Маска подсети: 1111 1111 1111 1111 1111 1111 11|00 0000 (255.255.255.192)
Биты: /8 /16 /24 /32

**Broadcast-адрес:**
Если установить все биты хостовой части IPv4-адреса в 1, мы получим broadcast-адрес.

IPv4: 1100 0000 1010 1000 0000 1100 10|11 1111 (192.168.12.191/26)
Маска подсети: 1111 1111 1111 1111 1111 1111 11|00 0000 (255.255.255.192)
Биты: /8 /16 /24 /32

Учитывая, что адреса IPv4 192.168.12.128 и 192.168.12.191 назначены, все остальные адреса IPv4 находятся между 192.168.12.129-190. Теперь мы знаем, что эта подсеть предоставляет нам в общей сложности 64 - 2 (сетевой адрес и broadcast-адрес), то есть 62 адреса IPv4, которые мы можем назначить нашим хостам.

**Хосты**
Сетевой адрес: 192.168.12.128
Первый хост: 192.168.12.129
Другие хосты: ...
Последний хост: 192.168.12.190
Broadcast-адрес: 192.168.12.191

**Разделение на более мелкие подсети**
Предположим, что нам, в качестве администраторов, была поставлена задача разделить предоставленную нам подсеть на 4 дополнительные подсети. Поэтому важно знать, что мы можем разделить подсети только на основе двоичной системы.

Экспонента Значение
2^0 = 1
2^1 = 2
2^2 = 4
2^3 = 8
2^4 = 16
2^5 = 32
2^6 = 64
2^7 = 128
2^8 = 256

Таким образом, мы можем разделить известные нам 64 хоста на 4 части. Число 4 соответствует экспоненте 2^2 в двоичной системе, поэтому мы определяем количество битов для маски подсети, на которую мы должны ее расширить. Итак, у нас есть следующие параметры:

Подсеть: 192.168.12.128/26
Требуемые подсети: 4

Теперь мы увеличиваем нашу маску подсети на 2 бита с /26 до /28, и это выглядит следующим образом:

IPv4: 1100 0000 1010 1000 0000 1100 1000| 0000 (192.168.12.128/28)
Маска
подсети: 1111 1111 1111 1111 1111 1111 1111| 0000 (255.255.255.240)
Биты: /8 /16 /24 /32

Затем мы можем разделить 64 IPv4-адреса, которые у нас есть, на 4 части:

Хосты Математика Подсети Диапазон хостов для каждой подсети
64 / 4 = 16

Теперь мы знаем, какой размер будет каждая подсеть. Начиная от сетевого адреса (192.168.12.128), мы добавляем 16 хостов 4 раза:

Подсеть No. Сетевой адрес Первый хост Последний хост Broadcast-адрес CIDR
1 192.168.12.128 192.168.12.129 192.168.12.142 192.168.12.143 192.168.12.128/28
2 192.168.12.144 192.168.12.145 192.168.12.158 192.168.12.159 192.168.12.144/28
3 192.168.12.160 192.168.12.161 192.168.12.174 192.168.12.175 192.168.12.160/28
4 192.168.12.176 192.168.12.177 192.168.12.190 192.168.12.191 192.168.12.176/28

Ментальное разделение на подсети
Может показаться, что в разделении на подсети требуется много математики, но каждый октет повторяется, и все является степенями двойки, поэтому не нужно много запоминать. Сначала необходимо определить, какой октет изменяется.

1-й октет 2-й октет 3-й октет 4-й октет
/8 /16 /24 /32

Можно определить, какой октет IP-адреса может измениться, запоминая эти четыре числа. Учитывая сетевой адрес: 192.168.1.1/25, сразу становится очевидно, что 192.168.2.4 не будет в той же сети, потому что /25 подсеть означает, что только четвертый октет может измениться.

Далее определяется, какой размер может иметь каждая подсеть путем деления восьми на сетевую часть и просмотра остатка. Это также называется операцией "Modulo" (%) и широко используется в криптологии. Учитывая наш предыдущий пример с /25, (25 % 8) будет равно 1. Это потому, что восемь входит в 25 три раза (8 * 3 = 24). Остается 1, что является битом сети, зарезервированным для маски подсети. В каждом октете IP-адреса всего восемь битов. Если один используется для маски подсети, то уравнение становится 2^(8-1) или 2^7, то есть 128. В таблице ниже перечислены все числа.

Остаток Число В экспоненциальной форме В виде деления
0 256 2^8 256
1 128 2^7 256/2
2 64 2^6 256/2/2
3 32 2^5 256/2/2/2
4 16 2^4 256/2/2/2/2
5 8 2^3 256/2/2/2/2/2
6 4 2^2 256/2/2/2/2/2/2
7 2 2^1 256/2/2/2/2/2/2/2

Запоминая степени двойки до восьми, это может стать мгновенным вычислением. Однако, если забыть, то быстрее всего запомнить деление 256 пополам столько раз, сколько остаток.

Сложность в том, чтобы получить фактический диапазон IP-адресов, потому что 0 - это число, а не ноль в сети. Так что в нашем /25 с 128 IP-адресами первый диапазон будет 192.168.1.0-127. Первый адрес - это сетевой адрес, а последний - это broadcast-адрес, что означает, что используемое пространство IP будет 192.168.1.1-126. Если наш IP-адрес находится выше 128, то используемое IP-пространство будет 192.168.129-254 (128 - это сетевой адрес, а 255 - это broadcast-адрес).
